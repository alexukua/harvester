(function(a){function b(){a.fn.ajaxSubmit.debug&&(window.console&&window.console.log)&&window.console.log("[jquery.form] "+Array.prototype.join.call(arguments,""))}a.fn.ajaxSubmit=function(c){function d(){function d(){if(!s++){k.detachEvent?k.detachEvent("onload",d):k.removeEventListener("load",d,!1);var c=!0;try{if(t)throw"timeout";var e,g;g=k.contentWindow?k.contentWindow.document:k.contentDocument?k.contentDocument:k.document;var h="xml"==f.dataType||g.XMLDocument||a.isXMLDoc(g);b("isXml="+h);
if(!h&&(null==g.body||""==g.body.innerHTML)){if(--u){s=0;setTimeout(d,100);return}b("Could not access iframe DOM after 50 tries.");return}l.responseText=g.body?g.body.innerHTML:null;l.responseXML=g.XMLDocument?g.XMLDocument:g;l.getResponseHeader=function(a){return{"content-type":f.dataType}[a]};if("json"==f.dataType||"script"==f.dataType){var j=g.getElementsByTagName("textarea")[0];if(j)l.responseText=j.value;else{var q=g.getElementsByTagName("pre")[0];q&&(l.responseText=q.innerHTML)}}else if("xml"==
f.dataType&&!l.responseXML&&null!=l.responseText){g=l;var m=l.responseText,h=void 0;window.ActiveXObject?(h=new ActiveXObject("Microsoft.XMLDOM"),h.async="false",h.loadXML(m)):h=(new DOMParser).parseFromString(m,"text/xml");g.responseXML=h&&h.documentElement&&"parsererror"!=h.documentElement.tagName?h:null}e=a.httpData(l,f.dataType)}catch(v){c=!1,a.handleError(f,l,"error",v)}c&&(f.success(e,"success"),p&&a.event.trigger("ajaxSuccess",[l,f]));p&&a.event.trigger("ajaxComplete",[l,f]);p&&!--a.active&&
a.event.trigger("ajaxStop");f.complete&&f.complete(l,c?"success":"error");setTimeout(function(){i.remove();l.responseXML=null},100)}}var e=h[0];if(a(":input[name=submit]",e).length)alert('Error: Form elements must not be named "submit".');else{var f=a.extend({},a.ajaxSettings,c),g=a.extend(!0,{},a.extend(!0,{},a.ajaxSettings),f),j="jqFormIO"+(new Date).getTime(),i=a('<iframe id="'+j+'" name="'+j+'" src="'+f.iframeSrc+'" />'),k=i[0];i.css({position:"absolute",top:"-1000px",left:"-1000px"});var l={aborted:0,
responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;i.attr("src",f.iframeSrc)}},p=f.global;p&&!a.active++&&a.event.trigger("ajaxStart");p&&a.event.trigger("ajaxSend",[l,f]);if(g.beforeSend&&!1===g.beforeSend(l,g))g.global&&a.active--;else if(!l.aborted){var s=0,t=0;if(g=e.clk){var m=g.name;m&&!g.disabled&&(c.extraData=c.extraData||{},c.extraData[m]=g.value,"image"==
g.type&&(c.extraData[m+".x"]=e.clk_x,c.extraData[m+".y"]=e.clk_y))}setTimeout(function(){var b=h.attr("target"),g=h.attr("action");e.setAttribute("target",j);"POST"!=e.getAttribute("method")&&e.setAttribute("method","POST");e.getAttribute("action")!=f.url&&e.setAttribute("action",f.url);c.skipEncodingOverride||h.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});f.timeout&&setTimeout(function(){t=!0;d()},f.timeout);var l=[];try{if(c.extraData)for(var m in c.extraData)l.push(a('<input type="hidden" name="'+
m+'" value="'+c.extraData[m]+'" />').appendTo(e)[0]);i.appendTo("body");k.attachEvent?k.attachEvent("onload",d):k.addEventListener("load",d,!1);e.submit()}finally{e.setAttribute("action",g),b?e.setAttribute("target",b):h.removeAttr("target"),a(l).remove()}},10);var u=50}}}if(!this.length)return b("ajaxSubmit: skipping submit process - no element selected"),this;"function"==typeof c&&(c={success:c});var e=a.trim(this.attr("action"));e&&(e=(e.match(/^([^#]+)/)||[])[1]);e=e||window.location.href||"";
c=a.extend({url:e,type:this.attr("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},c||{});e={};this.trigger("form-pre-serialize",[this,c,e]);if(e.veto)return b("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(c.beforeSerialize&&!1===c.beforeSerialize(this,c))return b("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var f=this.formToArray(c.semantic);if(c.data){c.extraData=c.data;for(var g in c.data)if(c.data[g]instanceof
Array)for(var j in c.data[g])f.push({name:g,value:c.data[g][j]});else f.push({name:g,value:c.data[g]})}if(c.beforeSubmit&&!1===c.beforeSubmit(f,this,c))return b("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[f,this,c,e]);if(e.veto)return b("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;g=a.param(f);"GET"==c.type.toUpperCase()?(c.url+=(0<=c.url.indexOf("?")?"&":"?")+g,c.data=null):c.data=g;var h=this,i=[];c.resetForm&&i.push(function(){h.resetForm()});
c.clearForm&&i.push(function(){h.clearForm()});if(!c.dataType&&c.target){var k=c.success||function(){};i.push(function(b){a(c.target).html(b).each(k,arguments)})}else c.success&&i.push(c.success);c.success=function(a,b){for(var d=0,e=i.length;d<e;d++)i[d].apply(c,[a,b,h])};g=a("input:file",this).fieldValue();j=!1;for(e=0;e<g.length;e++)g[e]&&(j=!0);g.length&&!1!==c.iframe||c.iframe||j?c.closeKeepAlive?a.get(c.closeKeepAlive,d):d():a.ajax(c);this.trigger("form-submit-notify",[this,c]);return this};
a.fn.ajaxForm=function(b){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){a(this).ajaxSubmit(b);return!1}).bind("click.form-plugin",function(b){var c=b.target,f=a(c);if(!f.is(":submit,input:image")){c=f.closest(":submit");if(0==c.length)return;c=c[0]}var g=this;g.clk=c;"image"==c.type&&(void 0!=b.offsetX?(g.clk_x=b.offsetX,g.clk_y=b.offsetY):"function"==typeof a.fn.offset?(f=f.offset(),g.clk_x=b.pageX-f.left,g.clk_y=b.pageY-f.top):(g.clk_x=b.pageX-c.offsetLeft,g.clk_y=b.pageY-c.offsetTop));
setTimeout(function(){g.clk=g.clk_x=g.clk_y=null},100)})};a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};a.fn.formToArray=function(b){var d=[];if(0==this.length)return d;var e=this[0],f=b?e.getElementsByTagName("*"):e.elements;if(!f)return d;for(var g=0,j=f.length;g<j;g++){var h=f[g],i=h.name;if(i)if(b&&e.clk&&"image"==h.type)!h.disabled&&e.clk==h&&(d.push({name:i,value:a(h).val()}),d.push({name:i+".x",value:e.clk_x},{name:i+".y",value:e.clk_y}));else if((h=
a.fieldValue(h,!0))&&h.constructor==Array)for(var k=0,n=h.length;k<n;k++)d.push({name:i,value:h[k]});else null!==h&&"undefined"!=typeof h&&d.push({name:i,value:h})}if(!b&&e.clk&&(b=a(e.clk),f=b[0],(i=f.name)&&!f.disabled&&"image"==f.type))d.push({name:i,value:b.val()}),d.push({name:i+".x",value:e.clk_x},{name:i+".y",value:e.clk_y});return d};a.fn.formSerialize=function(b){return a.param(this.formToArray(b))};a.fn.fieldSerialize=function(b){var d=[];this.each(function(){var e=this.name;if(e){var f=
a.fieldValue(this,b);if(f&&f.constructor==Array)for(var g=0,j=f.length;g<j;g++)d.push({name:e,value:f[g]});else null!==f&&"undefined"!=typeof f&&d.push({name:this.name,value:f})}});return a.param(d)};a.fn.fieldValue=function(b){for(var d=[],e=0,f=this.length;e<f;e++){var g=a.fieldValue(this[e],b);null===g||("undefined"==typeof g||g.constructor==Array&&!g.length)||(g.constructor==Array?a.merge(d,g):d.push(g))}return d};a.fieldValue=function(b,a){var e=b.name,f=b.type,g=b.tagName.toLowerCase();"undefined"==
typeof a&&(a=!0);if(a&&(!e||b.disabled||"reset"==f||"button"==f||("checkbox"==f||"radio"==f)&&!b.checked||("submit"==f||"image"==f)&&b.form&&b.form.clk!=b||"select"==g&&-1==b.selectedIndex))return null;if("select"==g){var j=b.selectedIndex;if(0>j)return null;for(var e=[],g=b.options,h=(f="select-one"==f)?j+1:g.length,j=f?j:0;j<h;j++){var i=g[j];if(i.selected){var k=i.value;k||(k=i.attributes&&i.attributes.value&&!i.attributes.value.specified?i.text:i.value);if(f)return k;e.push(k)}}return e}return b.value};
a.fn.clearForm=function(){return this.each(function(){a("input,select,textarea",this).clearFields()})};a.fn.clearFields=a.fn.clearInputs=function(){return this.each(function(){var b=this.type,a=this.tagName.toLowerCase();"text"==b||"password"==b||"textarea"==a?this.value="":"checkbox"==b||"radio"==b?this.checked=!1:"select"==a&&(this.selectedIndex=-1)})};a.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})};
a.fn.enable=function(b){void 0==b&&(b=!0);return this.each(function(){this.disabled=!b})};a.fn.selected=function(b){void 0==b&&(b=!0);return this.each(function(){var d=this.type;"checkbox"==d||"radio"==d?this.checked=b:"option"==this.tagName.toLowerCase()&&(d=a(this).parent("select"),b&&(d[0]&&"select-one"==d[0].type)&&d.find("option").selected(!1),this.selected=b)})}})(jQuery);(function(a){a.widget("ui.tagit",{options:{itemName:"item",fieldName:"tags",availableTags:[],tagSource:null,removeConfirmation:!1,caseSensitive:!0,allowSpaces:!1,animate:!0,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,tabIndex:null,onTagAdded:null,onTagRemoved:null,onTagClicked:null},_create:function(){var b=this;this.element.is("input")?(this.tagList=a("<ul></ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.css("display",
"none")):this.tagList=this.element.find("ul, ol").andSelf().last();this._tagInput=a('<input type="text" />').addClass("ui-widget-content");this.options.tabIndex&&this._tagInput.attr("tabindex",this.options.tabIndex);this.options.tagSource=this.options.tagSource||function(b,c){var d=b.term.toLowerCase(),j=a.grep(this.options.availableTags,function(b){return 0===b.toLowerCase().indexOf(d)});c(this._subtractArray(j,this.assignedTags()))};a.isFunction(this.options.tagSource)&&(this.options.tagSource=
a.proxy(this.options.tagSource,this));this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(a('<li class="tagit-new"></li>').append(this._tagInput)).click(function(c){var d=a(c.target);d.hasClass("tagit-label")?b._trigger("onTagClicked",c,d.closest(".tagit-choice")):b._tagInput.focus()});this.tagList.children("li").each(function(){a(this).hasClass("tagit-new")||(b.createTag(a(this).html(),a(this).attr("class"),!0),a(this).remove())});if(this.options.singleField)if(this.options.singleFieldNode){var c=
a(this.options.singleFieldNode),d=c.val().split(this.options.singleFieldDelimiter);c.val("");a.each(d,function(a,c){b.createTag(c,null,!1)})}else this.options.singleFieldNode=this.tagList.after('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'" />');this._tagInput.keydown(function(c){if(c.which==a.ui.keyCode.BACKSPACE&&""===b._tagInput.val()){var d=b._lastTag();!b.options.removeConfirmation||d.hasClass("remove")?b.removeTag(d):b.options.removeConfirmation&&d.addClass("remove ui-state-highlight")}else b.options.removeConfirmation&&
b._lastTag().removeClass("remove ui-state-highlight");if(c.which==a.ui.keyCode.COMMA||c.which==a.ui.keyCode.ENTER||c.which==a.ui.keyCode.TAB&&""!==b._tagInput.val()||c.which==a.ui.keyCode.SPACE&&!0!==b.options.allowSpaces&&('"'!=a.trim(b._tagInput.val()).replace(/^s*/,"").charAt(0)||'"'==a.trim(b._tagInput.val()).charAt(0)&&'"'==a.trim(b._tagInput.val()).charAt(a.trim(b._tagInput.val()).length-1)&&0!==a.trim(b._tagInput.val()).length-1))c.preventDefault(),b.createTag(b._cleanedInput(),null,!1),b._tagInput.autocomplete("close")}).blur(function(){b.createTag(b._cleanedInput(),
null,!1)});this._autocompleteVal=null;this._selectAction=function(){if(b._tagInput.val()==b._autocompleteVal)return b.createTag(b._autocompleteVal,null,!0),b.tagList.children(".tagit-new").children("input").val(""),!1};(this.options.availableTags||this.options.tagSource)&&this._tagInput.autocomplete({source:this.options.tagSource,close:this._selectAction,select:this._selectAction,minLength:2,autoFocus:!0,focus:function(c,d){b._autocompleteVal=d.item.value;a(this).val(b._unescapeHTML(d.item.value));
return!1}})},_cleanedInput:function(){return a.trim(this._tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.children(".tagit-choice:last")},assignedTags:function(){var b=this,c=[];this.options.singleField?(c=a(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter),""===c[0]&&(c=[])):this.tagList.children(".tagit-choice").each(function(){c.push(b.tagLabel(this))});return c},_updateSingleTagsField:function(b){a(this.options.singleFieldNode).val(b.join(this.options.singleFieldDelimiter))},
_subtractArray:function(b,c){for(var d=[],e=0;e<b.length;e++)-1==a.inArray(b[e],c)&&d.push(b[e]);return d},tagLabel:function(b){return this.options.singleField?a(b).children(".tagit-label").text():a(b).children("input").val()},_isNew:function(b){var a=this,d=!0;this.tagList.children(".tagit-choice").each(function(){if(a._formatStr(urlEncode(b))==a._formatStr(a.tagLabel(this)))return d=!1});return d},_formatStr:function(b){return this.options.caseSensitive?b:a.trim(b.toLowerCase())},_unescapeHTML:function(b){return a("<div/>").html(b).text()},
createTag:function(b,c,d){d&&(b=this._unescapeHTML(b));var e=this,b=a.trim(b);if(!this._isNew(b)||""===b)return!1;var d=a(this.options.onTagClicked?'<a class="tagit-label"></a>':'<span class="tagit-label"></span>').text(b),f=a("<li></li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(c).append(d),c=a("<span></span>").addClass("ui-icon ui-icon-close"),c=a('<a><span class="text-icon">\u00d7</span></a>').addClass("tagit-close").append(c).click(function(){e.removeTag(f)});
f.append(c);this.options.singleField?(c=this.assignedTags(),c.push(b),this._updateSingleTagsField(c)):(b=urlEncode(b),f.append('<input type="hidden" style="display:none;" value="'+b+'" name="'+this.options.itemName+"["+this.options.fieldName+'][]" />'));this._trigger("onTagAdded",null,f);this._tagInput.val("");this._tagInput.parent().before(f)},removeTag:function(b,c){c=c||this.options.animate;b=a(b);this._trigger("onTagRemoved",null,b);if(this.options.singleField){var d=this.assignedTags(),e=this.tagLabel(b),
d=a.grep(d,function(b){return b!=e});this._updateSingleTagsField(d)}c?b.fadeOut("fast").hide("blind",{direction:"horizontal"},"fast",function(){b.remove()}).dequeue():b.remove()},removeAll:function(){var b=this;this.tagList.children(".tagit-choice").each(function(a,d){b.removeTag(d,!1)})}})})(jQuery);jQuery.cookie=function(a,b,c){if("undefined"!=typeof b){c=c||{};null===b&&(b="",c.expires=-1);var d="";if(c.expires&&("number"==typeof c.expires||c.expires.toUTCString))"number"==typeof c.expires?(d=new Date,d.setTime(d.getTime()+864E5*c.expires)):d=c.expires,d="; expires="+d.toUTCString();var e=c.path?"; path="+c.path:"",f=c.domain?"; domain="+c.domain:"",c=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),d,e,f,c].join("")}else{b=null;if(document.cookie&&""!=document.cookie){c=
document.cookie.split(";");for(d=0;d<c.length;d++)if(e=jQuery.trim(c[d]),e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}};(function(a){a.fn.jLabel=function(b){function c(b){this.equals=function(b){return b.attr("id")==this.input.attr("id")};this.input=b;var c=a("label[for="+b.attr("id")+"]");0==c.size()&&(c=a("<label>").attr("for",b.attr("id")).text(b.attr("title")));b.before(c);c.css({"font-family":b.css("font-family"),"font-size":b.css("font-size"),"font-style":b.css("font-style"),"font-variant":b.css("font-variant"),"font-weight":b.css("font-weight"),"letter-spacing":b.css("letter-spacing"),"line-height":b.css("line-height"),
"text-decoration":b.css("text-decoration"),"text-transform":b.css("text-transform"),color:b.css("color"),cursor:b.css("cursor"),display:"inline-block"});c.mousedown(function(){return!1}).css({position:"relative","z-index":"100","margin-right":-c.width(),left:f.xShift+parseInt(b.css("padding-left"))+"px",top:f.yShift+"px"});this.label=c;""!=this.input.val()&&this.label.hide()}function d(b){var c;a.each(e,function(){if(this.equals(b))return c=this,!1});return c}var e=[],f=a.extend({},a.fn.jLabel.defaults,
b);return this.each(function(){var b=a(this);e.push(new c(b));b.focus(function(){var b=a(this);""==b.val()&&d(b).label.stop().fadeTo(f.speed,f.opacity)}).blur(function(){var b=a(this);""==b.val()&&d(b).label.stop().fadeTo(f.speed,1)}).keyup(function(){var b=a(this),c=d(b).label;""==b.val()?c.stop().fadeTo(f.speed,f.opacity):c.is(":visible")&&c.stop().fadeTo(f.speed,0,function(){c.hide()})})})};a.fn.jLabel.defaults={speed:200,opacity:0.4,xShift:2,yShift:0}})(jQuery);function fontSize(a,b,c,d,e,f){function g(b,a){void 0!=$.cookie&&$.cookie("font-size",b,{path:a})}$(a).html("<a href='javascript:void(0);' class='pkp_controllers_fontController_smallFont' title='Make font size smaller'>Make font size smaller</a> <a href='javascript:void(0);' class='pkp_controllers_fontController_defaultFont' title='Make font size default'>Make font size default</a> <a href='javascript:void(0);' class='pkp_controllers_fontController_largeFont' title='Make font size larger'>Make font size larger</a> ");
if(void 0!=$.cookie){var j=$.cookie("font-size");null!=j&&$(b).css("font-size",parseInt(j,10))}$(a+" .pkp_controllers_fontController_smallFont").click(function(){var d=parseInt($(b).css("font-size"),10)-1;d>=c&&$(b).css("font-size",d);d<=c&&$(a+" .pkp_controllers_fontController_smallFont").addClass("pkp_controllers_fontController_sdisabled");d<e&&$(a+" .pkp_controllers_fontController_largeFont").removeClass("pkp_controllers_fontController_ldisabled");g(d,f)});$(a+" .pkp_controllers_fontController_defaultFont").click(function(){$(b).css("font-size",
d);$(a+" .pkp_controllers_fontController_smallFont").removeClass("pkp_controllers_fontController_sdisabled");$(a+" .pkp_controllers_fontController_largeFont").removeClass("pkp_controllers_fontController_ldisabled");g(d,f)});$(a+" .pkp_controllers_fontController_largeFont").click(function(){var d=parseInt($(b).css("font-size"),10)+1;d<=e&&$(b).css("font-size",d);d>c&&$(a+" .pkp_controllers_fontController_smallFont").removeClass("pkp_controllers_fontController_sdisabled");d>=e&&$(a+" .pkp_controllers_fontController_largeFont").addClass("pkp_controllers_fontController_ldisabled");
g(d,f)})};function confirmAction(a,b){return confirm(b)?(a&&(document.location.href=a),!0):!1}function openHelp(a){window.open(a,"Help","width=700,height=600,screenX=100,screenY=100,toolbar=0,scrollbars=1")}function openComments(a){window.open(a,"Comments","width=700,height=600,screenX=100,screenY=100,toolbar=0,resizable=1,scrollbars=1")}function openWindow(a){window.open(a,"Window","width=600,height=550,screenX=100,screenY=100,toolbar=0,resizable=1,scrollbars=1")}
function openRTWindow(a){window.open(a,"RT","width=700,height=500,screenX=100,screenY=100,toolbar=0,resizable=1,scrollbars=1")}function openRTWindowWithToolbar(a){window.open(a,"RT","width=700,height=500,screenX=100,screenY=100,toolbar=1,resizable=1,scrollbars=1")}function getBrowserObject(a,b){var c=0,d;document.getElementById?d=document.getElementById(a):document.all?d=document.all[a]:document.layers&&(d=document.layers[a],c=1);b&&!c&&(d=d.style);return d}
function loadUrl(a){document.location.href=a}function createCookie(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString()}else c="";document.cookie=a+"="+b+c+"; path=/"}function readCookie(a){for(var a=a+"=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null}
function makeAsyncRequest(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}function sendAsyncRequest(a,b,c,d){a.open(d,b,!0);a.setRequestHeader("Content-Type","text/html; Charset=utf-8");a.send(c)}function changeFormAction(a,b){document.getElementById(a).action=b;document.getElementById(a).submit()}
function urlEncode(a){return encodeURIComponent(a).replace(/\%20/g,"+").replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/\~/g,"%7E")}function escapeHTML(a){return $("<div/>").text(a).html()}function unescapeHTML(a){return $("<div/>").html(a).text()};function jqueryValidatorI18n(a,b){var c;c=a+"/lib/pkp/js/lib/jquery/plugins/validate/localization/messages_";switch(b){case "fr_FR":case "ca_FR":eval($.getScript(c+"fr.js"));break;case "pt_BR":eval($.getScript(c+"ptbr.js"));break;case "pt_PT":eval($.getScript(c+"ptpt.js"));break;case "es_AR":case "es_ES":eval($.getScript(c+"es.js"))}};(function(a){a.pkp=a.pkp||{};a.pkp.classes=a.pkp.classes||{};a.pkp.controllers=a.pkp.controllers||{};a.pkp.plugins=a.pkp.plugins||{};a.pkp.plugins.blocks=a.pkp.plugins.blocks||{};a.pkp.plugins.generic=a.pkp.plugins.generic||{};a.pkp.classes.Helper=function(){throw Error("Trying to instantiate the Helper singleton!");};a.pkp.classes.Helper.CHARS_="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");a.pkp.classes.Helper.uuid=function(){var b=a.pkp.classes.Helper.CHARS_,c=Array(36),
d=0,e,f;for(f=0;36>f;f++)8==f||13==f||18==f||23==f?c[f]="-":14==f?c[f]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),e=d&15,d>>=4,c[f]=b[19==f?e&3|8:e]);return c.join("")};a.pkp.classes.Helper.inherits=function(b,a){var d=function(){};d.prototype=a.prototype;b.parent_=a.prototype;b.prototype=new d;b.prototype.constructor=b;a.prototype.constructor==Object.prototype.constructor&&(a.prototype.constructor=a)};a.pkp.classes.Helper.objectFactory=function(b,c){var d,e;d=a.pkp.classes.Helper.resolveObjectName(b);
e=a.pkp.classes.Helper.getObjectProxyInstance();a.extend(!0,e,a.pkp.classes.ObjectProxy);a.pkp.classes.Helper.inherits(e,d);a.extend(!0,e.prototype,a.pkp.classes.ObjectProxy.prototype);return new e(b,c)};a.pkp.classes.Helper.resolveObjectName=function(b){var c,d,e;c=b.split(".");if("$"!=c.shift())throw Error(['Namespace "',c[0],'" for object"',b,'" is currently not supported!'].join(""));e=c[c.length-1];if(e.charAt(0).toUpperCase()!==e.charAt(0))throw Error(['The name "',b,'" does not point to aconstructor which must always be upper case!'].join(""));
e=a;for(d in c)if(e=e[c[d]],void 0===e)throw Error(['Constructor for object "',b,'" not found!'].join(""));if(!a.isFunction(e))throw Error(['The name "',b,'" does not point to a,constructor which must always be a function!'].join());return e};a.pkp.classes.Helper.getObjectProxyInstance=function(){var b=function(b,a){this.objectName_=b;this.parent.apply(this,a)};b.objectName_="";b.prototype.parent=function(){};return b};a.pkp.classes.Helper.injectMixin=function(b,c){var d=a.pkp.classes.Helper.objectFactory(c,
[]);a.extend(!0,b,d)};a.pkp.classes.Helper.curry=function(b,a,d){if(2<arguments.length){var e,f;e=Array.prototype.slice.call(arguments,2);return function(){f=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(f,e);return b.apply(a,f)}}return function(){return b.apply(a,arguments)}}})(jQuery);(function(a){a.pkp.classes.ObjectProxy=function(){};a.pkp.classes.ObjectProxy.prototype.objectName_="";a.pkp.classes.ObjectProxy.prototype.self=function(b,c){var d,e;for(d=this.constructor;d;d=d.parent_&&d.parent_.constructor)if(d.hasOwnProperty(b))return d=d[b],a.isFunction(d)?(e=Array.prototype.slice.call(arguments,1),d.apply(this,e)):d;throw Error(['Static property "',b,'" not found!'].join(""));};a.pkp.classes.ObjectProxy.prototype.parent=function(b,c){var d,e,f,g;d=a.pkp.classes.ObjectProxy.prototype.parent.caller;
if(d.parent_)return e=Array.prototype.slice.call(arguments),d.parent_.constructor.apply(this,e);e=Array.prototype.slice.call(arguments,1);if(this.hasOwnProperty(b)&&this[b]===d)return this.constructor.parent_[b].apply(this,e);f=!1;for(g=this.constructor;g;g=g.parent_&&g.parent_.constructor)if(g.prototype.hasOwnProperty(b)&&g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(this,e);throw Error("Trying to call parent from a method of one name to a method of a different name");};a.pkp.classes.ObjectProxy.prototype.getObjectName=
function(){return this.objectName_}})(jQuery);(function(a){a.pkp.classes.Handler=function(b,a){if(1<b.length)throw Error("jQuery selector contained more than one handler!");this.$htmlElement_=b;if(void 0!==this.data("handler"))throw Error(['The handler "',this.getObjectName(),'" has already been bound to the selected element!'].join(""));this.eventBindings_={};this.dataItems_={};this.publishedEvents_={};a.$eventBridge&&(this.$eventBridge_=a.$eventBridge);if(a.publishChangeEvents){this.publishChangeEvents_=a.publishChangeEvents;var d;for(d=0;d<
this.publishChangeEvents_.length;d++)this.publishEvent(this.publishChangeEvents_[d])}else this.publishChangeEvents_=[];this.data("handler",this)};a.pkp.classes.Handler.prototype.publishChangeEvents_=null;a.pkp.classes.Handler.prototype.$htmlElement_=null;a.pkp.classes.Handler.prototype.eventBindings_=null;a.pkp.classes.Handler.prototype.dataItems_=null;a.pkp.classes.Handler.prototype.publishedEvents_=null;a.pkp.classes.Handler.prototype.$eventBridge_=null;a.pkp.classes.Handler.getHandler=function(b){b=
b.data("pkp.handler");if(!(b instanceof a.pkp.classes.Handler))throw Error("There is no handler bound to this element!");return b};a.pkp.classes.Handler.prototype.getHtmlElement=function(){a.pkp.classes.Handler.checkContext_(this);return this.$htmlElement_};a.pkp.classes.Handler.prototype.publishChangeEvents=function(){var b;for(b=0;b<this.publishChangeEvents_.length;b++)this.trigger(this.publishChangeEvents_[b])};a.pkp.classes.Handler.prototype.handleEvent=function(b){var c,d,e,f,g,j;c=a(this);d=
a.pkp.classes.Handler.getHandler(c);if(c[0]!==d.getHtmlElement.call(d)[0])throw Error("An invalid handler is bound to the calling element of an event!");c=d.eventBindings_[b.type];if(void 0===c)return!1;e=a.makeArray(arguments);f=!0;e.unshift(this);g=0;for(j=c.length;g<j&&!(!1===c[g].apply(d,e)&&(f=!1),b.isImmediatePropagationStopped());g++);b.stopPropagation();return f};a.pkp.classes.Handler.prototype.callbackWrapper=function(b,c){a.pkp.classes.Handler.checkContext_(this);c||(c=this);return function(){var d;
d=a.makeArray(arguments);d.unshift(this);return b.apply(c,d)}};a.pkp.classes.Handler.prototype.remoteResponse=function(b,a){return this.handleJson(a)};a.pkp.classes.Handler.prototype.remove=function(){a.pkp.classes.Handler.checkContext_(this);var b,c;b=this.getHtmlElement();b.unbind(".pkpHandler");for(c in this.dataItems_)"pkp.handler"!==c&&b.removeData(c);b.trigger("pkpRemoveHandler");b.unbind(".pkpHandlerRemove");b.removeData("pkp.handler")};a.pkp.classes.Handler.prototype.handleJson=function(b){if(!b)throw Error("Server error: Server returned no or invalid data!");
if(!0===b.status)return b.event&&(b.event.data?this.trigger(b.event.name,b.event.data):this.trigger(b.event.name)),b;b.content&&alert(b.content);return!1};a.pkp.classes.Handler.prototype.setHtmlElement=function(b){a.pkp.classes.Handler.checkContext_(this);return this.$htmlElement_=b};a.pkp.classes.Handler.prototype.bind=function(b,c){a.pkp.classes.Handler.checkContext_(this);if(!this.eventBindings_[b]){this.eventBindings_[b]=[];var d;d=".pkpHandler";"pkpRemoveHandler"===b&&(d=".pkpHandlerRemove");
this.getHtmlElement().bind(b+d,this.handleEvent)}this.eventBindings_[b].push(c)};a.pkp.classes.Handler.prototype.unbind=function(b,c){a.pkp.classes.Handler.checkContext_(this);if(!this.eventBindings_[b])return!1;var d,e;d=0;for(e=this.eventBindings_[b].length;d<e;d++)if(this.eventBindings_[b][d]===c){this.eventBindings_[b].splice([d],1);break}0===this.eventBindings_[b].length&&(delete this.eventBindings_[b],this.getHtmlElement().unbind(b,this.handleEvent));return!0};a.pkp.classes.Handler.prototype.data=
function(b,c){a.pkp.classes.Handler.checkContext_(this);b="pkp."+b;void 0!==c&&(this.dataItems_[b]=!0);return this.getHtmlElement().data(b,c)};a.pkp.classes.Handler.prototype.trigger=function(b,a){void 0===a&&(a=null);this.getHtmlElement().triggerHandler(b,a);this.publishedEvents_[b]||this.triggerPublicEvent_(b,a)};a.pkp.classes.Handler.prototype.publishEvent=function(b){this.publishedEvents_[b]||(this.publishedEvents_[b]=!0,this.bind(b,function(a,d,e){var f=null;2<arguments.length&&(f=Array.prototype.slice.call(arguments,
2));this.triggerPublicEvent_(b,f)}))};a.pkp.classes.Handler.prototype.switchViz=function(b){a(b.currentTarget).parent().parent().find("span").toggle()};a.pkp.classes.Handler.prototype.initializeTinyMCE=function(){if("undefined"!==typeof tinyMCE){var b=this.getHtmlElement().attr("id");setTimeout(function(){a("#"+b).find(".richContent").each(function(){var b=a(this).attr("id");tinyMCE.execCommand("mceAddControl",!1,b)})},500)}};a.pkp.classes.Handler.prototype.triggerPublicEvent_=function(b,c){this.getHtmlElement().parent().trigger(b,
c);this.$eventBridge_&&a('[id^="'+this.$eventBridge_+'"]').trigger(b,c)};a.pkp.classes.Handler.checkContext_=function(b){if(!(b instanceof a.pkp.classes.Handler))throw Error("Trying to call handler method in non-handler context!");}})(jQuery);(function(a){a.pkp.classes.linkAction=a.pkp.classes.linkAction||{};a.pkp.classes.linkAction.LinkActionRequest=function(b,a){this.$linkActionElement=b;this.options=a;b.is("a")&&a.url&&b.attr("href",a.url)};a.pkp.classes.linkAction.LinkActionRequest.prototype.$linkActionElement=null;a.pkp.classes.linkAction.LinkActionRequest.prototype.options=null;a.pkp.classes.linkAction.LinkActionRequest.prototype.activate=function(){this.getLinkActionElement().trigger("actionStart");return!1};a.pkp.classes.linkAction.LinkActionRequest.prototype.finish=
function(){this.options.finishCallback&&this.options.finishCallback();this.getLinkActionElement().trigger("actionStop");return!1};a.pkp.classes.linkAction.LinkActionRequest.prototype.getUrl=function(){return this.options.url?this.options.url:null};a.pkp.classes.linkAction.LinkActionRequest.prototype.getOptions=function(){return this.options};a.pkp.classes.linkAction.LinkActionRequest.prototype.getLinkActionElement=function(){return this.$linkActionElement}})(jQuery);(function(a){a.pkp.classes.linkAction.ModalRequest=function(b,a){this.parent(b,a)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.ModalRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.ModalRequest.prototype.$dialog_=null;a.pkp.classes.linkAction.ModalRequest.prototype.activate=function(b,c){var d=this.getOptions(),e=this.getLinkActionElement(),f=e.text();void 0===d.title&&(""===f&&(f=e.attr("title")),d.title=f);e=a.pkp.classes.Helper.uuid();if(!d.modalHandler)throw Error('The "modalHandler" setting is required in a ModalRequest');
f=this.getLinkActionElement();f=a.pkp.classes.Handler.getHandler(f);f=a.extend(!0,{$eventBridge:f.getStaticId()},d);this.$dialog_=a("<div id="+e+"></div>").pkpHandler(d.modalHandler,f);a.pkp.classes.Handler.getHandler(this.$dialog_).bind("pkpRemoveHandler",a.pkp.classes.Helper.curry(this.finish,this));return this.parent("activate",b,c)};a.pkp.classes.linkAction.ModalRequest.prototype.finish=function(){this.$dialog_.remove();return this.parent("finish")}})(jQuery);(function(a){a.pkp.classes.linkAction.RedirectRequest=function(b,a){this.parent(b,a)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.RedirectRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.RedirectRequest.prototype.activate=function(b,a){var d=this.getOptions();window.location=d.url;return this.parent("activate",b,a)}})(jQuery);(function(a){a.pkp.classes.linkAction.AjaxRequest=function(b,a){this.parent(b,a)};a.pkp.classes.Helper.inherits(a.pkp.classes.linkAction.AjaxRequest,a.pkp.classes.linkAction.LinkActionRequest);a.pkp.classes.linkAction.AjaxRequest.prototype.activate=function(b,c){var d=this.parent("activate",b,c),e=this.getOptions(),f=a.pkp.classes.Helper.curry(this.handleResponse,this);switch(e.requestType){case "get":a.getJSON(e.url,f);break;case "post":a.post(e.url,f,"json")}return d};a.pkp.classes.linkAction.AjaxRequest.prototype.handleResponse=
function(b){this.getLinkActionElement().data("pkp.handler").handleJson(b);this.finish()}})(jQuery);(function(a){a.pkp.classes.notification=a.pkp.classes.notification||{};a.pkp.classes.notification.NotificationHelper=function(){};a.pkp.classes.notification.NotificationHelper.redirectNotifyUserEvent=function(b,c){var d,e,f,g,j,h,i,k,n,q,r;if(void 0!==c.content)b.getHtmlElement().parent().trigger("notifyUser",[c]);else{d=b.getHtmlElement();e=!1;!(b instanceof a.pkp.controllers.SiteHandler)&&0<a(c).parents(".pkp_controllers_grid").length&&(d.parent().trigger("notifyUser"),e=!0);d=a(".pkp_notification",
d);f=[];g=0;for(j=d.length;g<j;g++)if(i=a(d[g]),!(0<i.parents(":hidden").length)){h=i.parents();n=0;for(q=h.length;n<q;n++)if(k=a(h[n]).data("pkp.handler"),k instanceof a.pkp.classes.Handler){r=a(h[n]);break}if(r.has(c[0]).length||r[0]==c){if(0<i.parents(".ui-accordion:first").length&&(h=i.parents(".ui-accordion:first"),!h.has(c[0])))continue;f.push(i)}}if(f.length)for(g=f.length-1;-1<g;g--)f[g].triggerHandler("notifyUser");else e||b.getHtmlElement().parent().trigger("notifyUser")}}})(jQuery);(function(a){a.pkp.classes.features=a.pkp.classes.features||{};a.pkp.classes.features.Feature=function(b,a){this.gridHandler=b;this.options_=a;this.addFeatureHtml(this.getGridHtmlElement(),a)};a.pkp.classes.features.Feature.prototype.gridHandler=null;a.pkp.classes.features.Feature.prototype.options_=null;a.pkp.classes.features.Feature.prototype.getOptions=function(){return this.options_};a.pkp.classes.features.Feature.prototype.init=function(){throw Error("Abstract method!");};a.pkp.classes.features.Feature.prototype.appendElement=
function(){return!1};a.pkp.classes.features.Feature.prototype.replaceElement=function(){return!1};a.pkp.classes.features.Feature.prototype.callbackWrapper=function(b,a){return this.gridHandler.callbackWrapper(b,a)};a.pkp.classes.features.Feature.prototype.addFeatureHtml=function(){};a.pkp.classes.features.Feature.prototype.getGridHtmlElement=function(){return this.gridHandler.getHtmlElement()}})(jQuery);(function(a){a.pkp.controllers.SiteHandler=function(b,c){this.parent(b,c);this.options_=c;this.unsavedFormElements_=[];a(".go").button();this.bind("redirectRequested",this.redirectToUrl);this.bind("notifyUser",this.fetchNotificationHandler_);this.bind("updateHeader",this.updateHeaderHandler_);this.bind("updateSidebar",this.updateSidebarHandler_);this.bind("callWhenClickOutside",this.callWhenClickOutsideHandler_);this.bind("mousedown",this.mouseDownHandler_);this.bind("gridInitialized",this.updateHelpDisplayHandler_);
this.bind("toggleInlineHelp",this.toggleInlineHelpHandler_);a(window).bind("beforeunload",this.pageUnloadHandler_);a.ajaxSetup({cache:!1});this.setMainMaxWidth_();a("select.applyPlugin",b).selectBox();c.hasSystemNotifications&&this.trigger("notifyUser");this.bind("formChanged",this.callbackWrapper(this.registerUnsavedFormElement_));this.bind("unregisterChangedForm",this.callbackWrapper(this.unregisterUnsavedFormElement_));this.bind("modalCanceled",this.callbackWrapper(this.unregisterUnsavedFormElement_));
this.bind("unregisterAllForms",this.callbackWrapper(this.unregisterAllFormElements_));this.outsideClickChecks_={}};a.pkp.classes.Helper.inherits(a.pkp.controllers.SiteHandler,a.pkp.classes.Handler);a.pkp.controllers.SiteHandler.prototype.options_=null;a.pkp.controllers.SiteHandler.prototype.outsideClickChecks_=null;a.pkp.controllers.SiteHandler.prototype.unsavedFormElements_=null;a.pkp.controllers.SiteHandler.prototype.triggerTinyMCEInitialized=function(b){a("#"+b.editorId).trigger("tinyMCEInitialized",
[b])};a.pkp.controllers.SiteHandler.prototype.redirectToUrl=function(b,a,d){window.location=d};a.pkp.controllers.SiteHandler.prototype.registerUnsavedFormElement_=function(b,c,d){b=a(d.target.lastElementChild).attr("id");-1==a.inArray(b,this.unsavedFormElements_)&&this.unsavedFormElements_.push(b)};a.pkp.controllers.SiteHandler.prototype.unregisterUnsavedFormElement_=function(b,c,d){b=a(d.target.lastElementChild).attr("id");b=a.inArray(b,this.unsavedFormElements_);-1!==b&&delete this.unsavedFormElements_[b]};
a.pkp.controllers.SiteHandler.prototype.unregisterAllFormElements_=function(){this.unsavedFormElements_=[]};a.pkp.controllers.SiteHandler.prototype.toggleInlineHelpHandler_=function(){a.ajax({url:this.options_.toggleHelpUrl});this.options_.inlineHelpState=this.options_.inlineHelpState?0:1;this.updateHelpDisplayHandler_();return!1};a.pkp.controllers.SiteHandler.prototype.updateHelpDisplayHandler_=function(){var b;b=this.getHtmlElement();this.options_.inlineHelpState?(b.find(".pkp_grid_description, #legend, .pkp_help").css("visibility",
"visible").show(),b.find('[id^="toggleHelp"]').html(this.options_.toggleHelpOffText)):(b.find(".pkp_grid_description, #legend, .pkp_help").hide(),b.find('[id^="toggleHelp"]').html(this.options_.toggleHelpOnText))};a.pkp.controllers.SiteHandler.prototype.fetchNotificationHandler_=function(b,c,d){void 0!==d?this.showNotification_(d):a.ajax({url:this.options_.fetchNotificationUrl,data:this.options_.requestOptions,success:this.callbackWrapper(this.showNotificationResponseHandler_),dataType:"json",async:!1})};
a.pkp.controllers.SiteHandler.prototype.updateHeaderHandler_=function(){a.pkp.classes.Handler.getHandler(a("#headerContainer")).reload()};a.pkp.controllers.SiteHandler.prototype.updateSidebarHandler_=function(){a.pkp.classes.Handler.getHandler(a("#sidebarContainer")).reload()};a.pkp.controllers.SiteHandler.prototype.callWhenClickOutsideHandler_=function(b,a,d){void 0!==d.container&&void 0!==d.callback&&(b=d.container.attr("id"),this.outsideClickChecks_[b]=d)};a.pkp.controllers.SiteHandler.prototype.mouseDownHandler_=
function(b,c){var d;if(!a.isEmptyObject(this.outsideClickChecks_))for(d in this.outsideClickChecks_)this.processOutsideClickCheck_(this.outsideClickChecks_[d],c);return!0};a.pkp.controllers.SiteHandler.prototype.processOutsideClickCheck_=function(b,a){if("click"!==a.type&&"mousedown"!==a.type&&"mouseup"!==a.type)throw Error("Can not check outside click with the passed event: "+a.type+".");var d=b.container;return d.is(":hidden")||void 0!==b.skipWhenVisibleModals&&b.skipWhenVisibleModals&&0<this.getHtmlElement().find("div.ui-dialog").length?
!1:0===d.has(a.target).length?(delete this.outsideClickChecks_[d.attr("id")],b.callback(),!0):!1};a.pkp.controllers.SiteHandler.prototype.pageUnloadHandler_=function(){var b,c,d;b=a.pkp.classes.Handler.getHandler(a("body"));c=0;for(d in b.unsavedFormElements_)d&&c++;return 0<c?a.pkp.locale.form_dataHasChanged:null};a.pkp.controllers.SiteHandler.prototype.isFormUnsaved=function(b){return null!==this.unsavedFormElements_&&void 0!==this.unsavedFormElements_[b]?!0:!1};a.pkp.controllers.SiteHandler.prototype.showNotificationResponseHandler_=
function(b,a){this.showNotification_(a)};a.pkp.controllers.SiteHandler.prototype.showNotification_=function(b){var c,d,b=this.handleJson(b);if(!1!==b&&b.content.general)for(c in b=b.content.general,b)for(d in b[c])a.pnotify(b[c][d])};a.pkp.controllers.SiteHandler.prototype.setMainMaxWidth_=function(){var b,c,d,e,f;b=this.getHtmlElement();c=a(".pkp_structure_content",b).width();d=a(".pkp_structure_sidebar_left",b).outerWidth(!0);e=a(".pkp_structure_sidebar_right",b).outerWidth(!0);b=a(".pkp_structure_main",
b);f=b.outerWidth(!0)-b.width();b.css("max-width",c-(d+e+f))}})(jQuery);(function(a){a.pkp.controllers.UploaderHandler=function(b,c){this.parent(b,c);if(!(b.is("div")&&""===b.text()))throw Error("An uploader widget controller can only be attached to an empty div!");var d=a.extend({},this.self("DEFAULT_PROPERTIES_"),{url:c.uploadUrl,flash_swf_url:c.baseUrl+"/lib/pkp/js/lib/plupload/plupload.flash.swf",silverlight_xap_url:c.baseUrl+"/lib/pkp/js/lib/plupload/plupload.silverlight.xap"});b.plupload(d);d=b.plupload("getUploader");d.refresh();/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)||
b.find("div.plupload").css("z-index",99999);b.find("a.plupload_add").css("z-index",99999);d.bind("FilesAdded",this.callbackWrapper(this.limitQueueSize));d.bind("QueueChanged",this.callbackWrapper(this.refreshUploader))};a.pkp.classes.Helper.inherits(a.pkp.controllers.UploaderHandler,a.pkp.classes.Handler);a.pkp.controllers.UploaderHandler.prototype.limitQueueSize=function(b,a){1<a.files.length&&(a.splice(0,1),a.refresh())};a.pkp.controllers.UploaderHandler.prototype.refreshUploader=function(b,a){a.refresh()};
a.pkp.controllers.UploaderHandler.DEFAULT_PROPERTIES_={runtimes:"html5,flash,silverlight",max_file_size:"20mb",multi_selection:!1,file_data_name:"uploadedFile",multipart:!0,headers:{browser_user_agent:navigator.userAgent}}})(jQuery);(function(a){a.pkp.controllers.NotificationHandler=function(b,a){this.parent(b,a);this.options_=a;this.bind("notifyUser",this.fetchNotificationHandler_);this.getHtmlElement().hide();this.getHtmlElement().triggerHandler("notifyUser")};a.pkp.classes.Helper.inherits(a.pkp.controllers.NotificationHandler,a.pkp.classes.Handler);a.pkp.controllers.NotificationHandler.prototype.options_=null;a.pkp.controllers.NotificationHandler.prototype.trivialTimer_=null;a.pkp.controllers.NotificationHandler.prototype.fetchNotificationHandler_=
function(){var b={};b.requestOptions=this.options_.requestOptions;a.ajax({type:"POST",url:this.options_.fetchNotificationUrl,data:b,success:this.callbackWrapper(this.showNotificationResponseHandler_),dataType:"json",async:!1})};a.pkp.controllers.NotificationHandler.prototype.showNotificationResponseHandler_=function(b,c){clearTimeout(this.trivialTimer_);var d=this.getHtmlElement(),e=this.handleJson(c),f,g,j;if(!1!==e)if(e.content.inPlace){f=this.concatenateNotifications_(e.content.inPlace);g=this.removeAlreadyShownNotifications_(e);
d.html(f);d.show();e=this.getTrivialNotifications_(e.content.inPlace);if(!this.visibleWithoutScrolling_()&&g)for(j in d.parent().trigger("notifyUser",[g]),e)g=e[j],a("#pkp_notification_"+g,this.getHtmlElement()).remove();0===d.children().length?d.hide():this.addTimerToNotifications(e)}else this.getHtmlElement().empty(),this.getHtmlElement().hide()};a.pkp.controllers.NotificationHandler.prototype.visibleWithoutScrolling_=function(){var b=this.getHtmlElement(),c=b.offset().top+this.getHtmlElement().height()/
2,d=a(window).scrollTop(),e=d+a(window).height(),f=b.parents(".ui-dialog-content");return 0<f.length&&(b=f.offset().top,f=b+f.height(),c<b||c>f)?!1:c<d||c>e?!1:!0};a.pkp.controllers.NotificationHandler.prototype.removeAlreadyShownNotifications_=function(b){var c=!0,d,e,f;for(d in b.content.inPlace)for(e in b.content.inPlace[d])f=a("#pkp_notification_"+e),0<f.length?(delete b.content.inPlace[d][e],delete b.content.general[d][e]):c=!1;return c?!1:b};a.pkp.controllers.NotificationHandler.prototype.concatenateNotifications_=
function(b){var a="",d,e;for(d in b)for(e in b[d])a+=b[d][e];return a};a.pkp.controllers.NotificationHandler.prototype.getTrivialNotifications_=function(b){var a=[],d,e;for(d in b)if(1==d)for(e in b[d])a.push(e);return a};a.pkp.controllers.NotificationHandler.prototype.addTimerToNotifications=function(b){var c=function(){a(this).remove()};b.length&&(this.trivialTimer_=setTimeout(function(){var d,e;for(d in b)e=a("#pkp_notification_"+b[d]),e.fadeOut(400,c())},6E3))}})(jQuery);(function(a){a.pkp.controllers.UrlInDivHandler=function(b,a){this.parent(b,a);this.sourceUrl_=a.sourceUrl;this.reload()};a.pkp.classes.Helper.inherits(a.pkp.controllers.UrlInDivHandler,a.pkp.classes.Handler);a.pkp.controllers.UrlInDivHandler.sourceUrl_=null;a.pkp.controllers.UrlInDivHandler.prototype.reload=function(){a.get(this.sourceUrl_,this.callbackWrapper(this.handleLoadedContent_),"json")};a.pkp.controllers.UrlInDivHandler.prototype.handleLoadedContent_=function(b,a){var d=this.handleJson(a);
!0===d.status?void 0===d.content?this.getHtmlElement().hide():this.getHtmlElement().hide().html(d.content).fadeIn(400):alert(d.content);return!1}})(jQuery);(function(a){a.pkp.controllers.form=a.pkp.controllers.form||{};a.pkp.controllers.form.FormHandler=function(b,c){this.parent(b,c);if(!b.is("form"))throw Error("A form handler controller can only be bound to an HTML form element!");!1!==c.transformButtons&&a(".button",b).button();c.submitHandler&&(this.callerSubmitHandler_=c.submitHandler);c.cancelRedirectUrl&&(this.cancelRedirectUrl_=c.cancelRedirectUrl);"undefined"!==typeof c.trackFormChanges&&(this.trackFormChanges=c.trackFormChanges);c.disableControlsOnSubmit&&
(this.disableControlsOnSubmit=c.disableControlsOnSubmit);c.enableDisablePairs&&(this.enableDisablePairs_=c.enableDisablePairs,this.setupEnableDisablePairs());var d=b.validate({onfocusout:this.callbackWrapper(this.onFocusOutValidation_),errorClass:"error",highlight:function(b,c){a(b).parent().parent().addClass(c)},unhighlight:function(b,c){a(b).parent().parent().removeClass(c)},submitHandler:this.callbackWrapper(this.submitHandler_),showErrors:this.callbackWrapper(this.showErrors)});a("#cancelFormButton",
b).click(this.callbackWrapper(this.cancelForm));a("#resetFormButton",b).click(this.callbackWrapper(this.resetForm));b.find(".showMore, .showLess").bind("click",this.switchViz);d.checkForm()?this.trigger("formValid"):this.trigger("formInvalid");this.initializeTinyMCE();a("#submitFormButton",b).click(this.callbackWrapper(this.pushTinyMCEChanges_));a(":input",b).change(this.callbackWrapper(this.formChange));this.publishEvent("tinyMCEInitialized");this.bind("tinyMCEInitialized",this.tinyMCEInitHandler_)};
a.pkp.classes.Helper.inherits(a.pkp.controllers.form.FormHandler,a.pkp.classes.Handler);a.pkp.controllers.form.FormHandler.prototype.disableControlsOnSubmit=!1;a.pkp.controllers.form.FormHandler.prototype.trackFormChanges=!0;a.pkp.controllers.form.FormHandler.prototype.callerSubmitHandler_=null;a.pkp.controllers.form.FormHandler.prototype.cancelRedirectUrl_=null;a.pkp.controllers.form.FormHandler.prototype.formChangesTracked=!1;a.pkp.controllers.form.FormHandler.prototype.enableDisablePairs_=null;
a.pkp.controllers.form.FormHandler.prototype.showErrors=function(b){"undefined"!==typeof tinyMCE&&tinyMCE.triggerSave();var c=a.extend(!0,{},b);setTimeout(this.callbackWrapper(function(){c.defaultShowErrors();c=null}),250);b.checkForm()?this.trigger("formValid"):(this.trigger("formInvalid"),this.enableFormControls())};a.pkp.controllers.form.FormHandler.prototype.formChange=function(){this.trackFormChanges&&!this.formChangesTracked&&(this.trigger("formChanged"),this.formChangesTracked=!0)};a.pkp.controllers.form.FormHandler.prototype.disableFormControls=
function(){this.disableControlsOnSubmit&&this.getHtmlElement().find(":submit").attr("disabled","disabled").addClass("ui-state-disabled");return!0};a.pkp.controllers.form.FormHandler.prototype.enableFormControls=function(){this.getHtmlElement().find(":submit").removeAttr("disabled").removeClass("ui-state-disabled");return!0};a.pkp.controllers.form.FormHandler.prototype.cancelForm=function(){this.unregisterForm();this.trigger("formCanceled");return!1};a.pkp.controllers.form.FormHandler.prototype.unregisterForm=
function(){this.formChangesTracked=!1;this.trigger("unregisterChangedForm")};a.pkp.controllers.form.FormHandler.prototype.resetForm=function(){this.formChangesTracked=!1;this.trigger("unregisterChangedForm");this.getHtmlElement().each(function(){this.reset()});return!1};a.pkp.controllers.form.FormHandler.prototype.setupEnableDisablePairs=function(){var b=this.getHtmlElement(),c;for(c in this.enableDisablePairs_)a(b).find("[id^='"+c+"']").bind("click",this.callbackWrapper(this.toggleDependentElement_));
return!0};a.pkp.controllers.form.FormHandler.prototype.submitFormWithoutValidation=function(b){b.settings.submitHandler=null;this.disableFormControls();this.getHtmlElement().submit();this.formChangesTracked=!1};a.pkp.controllers.form.FormHandler.prototype.initializeTinyMCE_=function(){if("undefined"!==typeof tinyMCE){var b;b=this.getHtmlElement().attr("id");setTimeout(function(){a("#"+b).find(".richContent").each(function(){tinyMCE.execCommand("mceAddControl",!1,a(this).attr("id").toString())})},
500)}};a.pkp.controllers.form.FormHandler.prototype.submitHandler_=function(b,c){var d=new a.Event("formSubmitRequested");a(c).find(".formWidget").trigger(d);d.isDefaultPrevented()||(a(c).find(".pkp_helpers_progressIndicator").show(),this.trigger("unregisterChangedForm"),null!==this.callerSubmitHandler_?(this.formChangesTracked=!1,this.callbackWrapper(this.callerSubmitHandler_).call(b,c)):this.submitFormWithoutValidation(b))};a.pkp.controllers.form.FormHandler.prototype.pushTinyMCEChanges_=function(){"undefined"!==
typeof tinyMCE&&tinyMCE.triggerSave();return!0};a.pkp.controllers.form.FormHandler.prototype.toggleDependentElement_=function(b){var c,d;c=this.getHtmlElement();d=a(b).attr("id");c=a(c).find("[id^='"+this.enableDisablePairs_[d]+"']");a(b).is(":checked")?a(c).attr("disabled",""):a(c).attr("disabled","disabled");return!0};a.pkp.controllers.form.FormHandler.prototype.tinyMCEInitHandler_=function(b,c,d){var e=d.editorId;a(d.getWin()).blur(this.callbackWrapper(function(){d.save();var b=this.getHtmlElement(),
c=a("#"+e,b);b.validate().element(c)}))};a.pkp.controllers.form.FormHandler.prototype.onFocusOutValidation_=function(b,c){var d=this.getHtmlElement();a(c).parents("#"+d.attr("id")).length&&b.element(c);return!0}})(jQuery);(function(a){a.pkp.controllers.form.ClientFormHandler=function(b,a){a.submitHandler=this.submitForm;this.parent(b,a)};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.ClientFormHandler,a.pkp.controllers.form.FormHandler);a.pkp.controllers.form.ClientFormHandler.prototype.submitForm=function(){var b;b=this.getHtmlElement().serializeArray();b.push({name:"clientSubmit",value:!0});this.trigger("formSubmitted",[a.param(b)])}})(jQuery);(function(a){a.pkp.controllers.form.AjaxFormHandler=function(b,a){a.submitHandler=this.submitForm;this.parent(b,a);this.bind("refreshForm",this.refreshFormHandler_);this.publishEvent("containerReloadRequested")};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.AjaxFormHandler,a.pkp.controllers.form.FormHandler);a.pkp.controllers.form.AjaxFormHandler.prototype.disableControlsOnSubmit=!0;a.pkp.controllers.form.AjaxFormHandler.prototype.submitForm=function(){var b=this.getHtmlElement();this.disableFormControls();
a.post(b.attr("action"),b.serialize(),this.callbackWrapper(this.handleResponse),"json")};a.pkp.controllers.form.AjaxFormHandler.prototype.refreshFormHandler_=function(b,a,d){d&&this.getHtmlElement().replaceWith(d)};a.pkp.controllers.form.AjaxFormHandler.prototype.handleResponse=function(b,c){var d,e;e=this.handleJson(c);if(!1!==e)if(""===e.content)d=new a.Event("formSubmitted"),a(this.getHtmlElement()).find(".formWidget").trigger(d),this.trigger("formSubmitted"),this.publishChangeEvents();else{if(void 0!==
e.reloadContainer)return this.trigger("dataChanged"),this.trigger("containerReloadRequested",[e]),e.status;d=this.getHtmlElement();d.replaceWith(e.content)}a(this.getHtmlElement()).find(".pkp_helpers_progressIndicator").hide();this.getHtmlElement().find(":submit").button();this.trigger("notifyUser",[this.getHtmlElement()]);return e.status}})(jQuery);(function(a){a.pkp.controllers.form.FileUploadFormHandler=function(b,a){this.parent(b,a);void 0!==a.resetUploader&&(this.resetUploader_=a.resetUploader);this.attachUploader_(a.$uploader,a.uploaderOptions);this.uploaderSetup(a.$uploader)};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.FileUploadFormHandler,a.pkp.controllers.form.AjaxFormHandler);a.pkp.controllers.form.FileUploadFormHandler.prototype.resetUploader_=!1;a.pkp.controllers.form.FileUploadFormHandler.prototype.handleResponse=function(b,
c){var d;this.resetUploader_&&(d=a("#plupload",this.getHtmlElement()).plupload("getUploader"),d.splice(),d.refresh(),a("#temporaryFileId",this.getHtmlElement()).val(""));return this.parent("handleResponse",b,c)};a.pkp.controllers.form.FileUploadFormHandler.prototype.uploaderSetup=function(a){a.plupload("getUploader").bind("FileUploaded",this.callbackWrapper(this.handleUploadResponse))};a.pkp.controllers.form.FileUploadFormHandler.prototype.handleUploadResponse=function(b,c,d,e){b=this.handleJson(a.parseJSON(e.response));
!1!==b&&(this.trigger("fileUploaded",[b.uploadedFile]),""===b.content?(c=this.getHtmlElement(),c=c.find("#temporaryFileId"),c.val(b.temporaryFileId)):this.getHtmlElement().replaceWith(b.content))};a.pkp.controllers.form.FileUploadFormHandler.prototype.attachUploader_=function(a,c){a.pkpHandler("$.pkp.controllers.UploaderHandler",c)}})(jQuery);(function(a){a.pkp.controllers.form.MultilingualInputHandler=function(a,c){this.parent(a,c);var d=null,d=a.hasClass("pkpTagit")?a.find(":input").filter(":visible"):a.find(":input").first();d.focus(this.callbackWrapper(this.focusHandler_));a.find(":input").blur(this.callbackWrapper(this.blurHandler_));this.publishEvent("tinyMCEInitialized");this.bind("tinyMCEInitialized",this.tinyMCEInitHandler_)};a.pkp.classes.Helper.inherits(a.pkp.controllers.form.MultilingualInputHandler,a.pkp.classes.Handler);
a.pkp.controllers.form.MultilingualInputHandler.prototype.focusHandler_=function(){this.showPopover_()};a.pkp.controllers.form.MultilingualInputHandler.prototype.blurHandler_=function(){setTimeout(this.callbackWrapper(function(){this.hasElementInFocus_()||this.hidePopover_()}),0);return!0};a.pkp.controllers.form.MultilingualInputHandler.prototype.hidePopover_=function(){var a=this.getHtmlElement();a.removeClass("localization_popover_container_focus");a.find(".localization_popover").hide()};a.pkp.controllers.form.MultilingualInputHandler.prototype.showPopover_=
function(){var a=this.getHtmlElement();a.addClass("localization_popover_container_focus");a.find(".localization_popover").width(a.width());a.find(".localization_popover").show()};a.pkp.controllers.form.MultilingualInputHandler.prototype.hasElementInFocus_=function(){return this.getHtmlElement().has(document.activeElement).length?!0:!1};a.pkp.controllers.form.MultilingualInputHandler.prototype.tinyMCEInitHandler_=function(b,c,d){b=a("#"+d.editorId).height();a(d.getBody()).height(78*(b/100));a(d.getWin()).focus(this.callbackWrapper(function(){this.trigger("callWhenClickOutside",
{container:this.getHtmlElement(),callback:this.callbackWrapper(this.hidePopover_),skipWhenVisibleModals:!1});var b=this.callbackWrapper(function(b){b=a(b.getWin());this.getHtmlElement().hasClass("localization_popover_container_focus")||b.focus()});d.onSetContent.remove(b);d.onSetContent.add(b);this.showPopover_()}));a(d.getWin()).blur(this.callbackWrapper(function(){if(a(d.getContainer()).find("iframe").attr("id")==a(document.activeElement).attr("id"))return!1;setTimeout(this.callbackWrapper(function(){this.hasElementInFocus_()||
this.hidePopover_()}),0)}))}})(jQuery);(function(a){a.pkp.controllers.grid=a.pkp.controllers.grid||{};a.pkp.controllers.grid.GridHandler=function(a,c){this.parent(a,c);this.initialize(c);this.initFeatures_(c.features)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.GridHandler,a.pkp.classes.Handler);a.pkp.controllers.grid.GridHandler.prototype.bodySelector=null;a.pkp.controllers.grid.GridHandler.prototype.fetchRowUrl=null;a.pkp.controllers.grid.GridHandler.prototype.gridId_=null;a.pkp.controllers.grid.GridHandler.prototype.fetchGridUrl_=
null;a.pkp.controllers.grid.GridHandler.prototype.features_=null;a.pkp.controllers.grid.GridHandler.prototype.getFetchRowUrl=function(){return this.fetchRowUrl};a.pkp.controllers.grid.GridHandler.prototype.getRows=function(){return a(".gridRow",this.getHtmlElement())};a.pkp.controllers.grid.GridHandler.prototype.getGridIdPrefix=function(){return"component-"+this.gridId_};a.pkp.controllers.grid.GridHandler.prototype.getRowIdPrefix=function(){return this.getGridIdPrefix()+"-row-"};a.pkp.controllers.grid.GridHandler.prototype.getRowDataId=
function(a){var c,d,e,a=a.attr("class").split(" ");for(c in a)if(e=a[c].indexOf("element"),-1!=e){d=a[c].slice(7);break}return d};a.pkp.controllers.grid.GridHandler.prototype.getParentRow=function(a){return a.parents(".gridRow:first")};a.pkp.controllers.grid.GridHandler.prototype.getElementsByType=function(b){return b.hasClass("gridRow")?(b=b.parents("tbody:first"),a(".gridRow",b)):null};a.pkp.controllers.grid.GridHandler.prototype.getEmptyElement=function(a){return a.hasClass("gridRow")?a.parents("tbody:first").next(".empty"):
null};a.pkp.controllers.grid.GridHandler.prototype.toggleRowActions=function(b){b=a(b).parents("tr").next(".row_controls");this.applyToggleRowActionEffect_(b)};a.pkp.controllers.grid.GridHandler.prototype.hideAllVisibleRowActions=function(){var b,c,d;b=a(".row_controls:visible",this.getHtmlElement());c=0;for(d=b.length;c<d;c++)this.applyToggleRowActionEffect_(a(b[c]))};a.pkp.controllers.grid.GridHandler.prototype.hideRowActionsDiv=function(){var b,c,d,e;b=a(".gridRow div.row_actions",this.getHtmlElement());
b.hide();c=0;for(d=b.length;c<d;c++)e=a(b[c]),e.parents(".row_container:first").attr("style","padding-left:0px !important")};a.pkp.controllers.grid.GridHandler.prototype.showRowActionsDiv=function(){var b,c,d,e;b=a(".gridRow div.row_actions",this.getHtmlElement());b.show();c=0;for(d=b.length;c<d;c++)e=a(b[c]),e.parents(".row_container:first").removeAttr("style")};a.pkp.controllers.grid.GridHandler.prototype.changeLinkActionsState=function(b,c){void 0===c&&(c=a(".pkp_controllers_linkAction",this.getHtmlElement()));
c.each(function(){var c;c=a.pkp.classes.Handler.getHandler(a(this));b?c.enableLink():c.disableLink()})};a.pkp.controllers.grid.GridHandler.prototype.resequenceRows=function(b){var c,d;for(d in b)c=b[d],c=a("#"+c),this.appendElement(c);this.updateControlRowsPosition()};a.pkp.controllers.grid.GridHandler.prototype.updateControlRowsPosition=function(){var b,c,d,e,f;b=this.getRows();c=0;for(d=b.length;c<d;c++)e=a(b[c]),f=this.getControlRowByGridRow(e),0<f.length&&f.insertAfter(e)};a.pkp.controllers.grid.GridHandler.prototype.initialize=
function(a){this.bind("dataChanged",this.refreshGridHandler);this.bind("addRow",this.addRowHandler_);this.bind("formSubmitted",this.refreshGridWithFilterHandler_);this.gridId_=a.gridId;this.fetchRowUrl=a.fetchRowUrl;this.fetchGridUrl_=a.fetchGridUrl;this.bodySelector=a.bodySelector;this.activateRowActions_();this.trigger("gridInitialized")};a.pkp.controllers.grid.GridHandler.prototype.callFeaturesHook=function(b,c){var d;a.isArray(c)||(c=[c]);for(d in this.features_)this.features_[d][b].apply(this.features_[d],
c)};a.pkp.controllers.grid.GridHandler.prototype.refreshGridHandler=function(b,c,d,e){e||(d?a.get(this.fetchRowUrl,{rowId:d},this.callbackWrapper(this.replaceElementResponseHandler),"json"):a.get(this.fetchGridUrl_,null,this.callbackWrapper(this.replaceGridResponseHandler_),"json"));this.trigger("gridRefreshRequested");this.publishChangeEvents()};a.pkp.controllers.grid.GridHandler.prototype.deleteElement=function(b){var c,d;if(1!==b.length)throw Error("There were "+b.length+" rather than 1 element to delete!");
c=!1;1==this.getElementsByType(b).length&&(c=!0);b.hasClass("gridRow")&&this.deleteControlsRow_(b);d=this.getEmptyElement(b);b.fadeOut(500,function(){a(this).remove();c&&d.fadeIn(500)})};a.pkp.controllers.grid.GridHandler.prototype.appendElement=function(a,c){if(void 0===c||null===c)c=this.getHtmlElement().find(this.bodySelector);c.append(a);this.getEmptyElement(a).hide();this.callFeaturesHook("appendElement",a)};a.pkp.controllers.grid.GridHandler.prototype.replaceElement=function(a,c){c.hasClass("gridRow")&&
this.deleteControlsRow_(a);a.replaceWith(c);this.callFeaturesHook("replaceElement",c)};a.pkp.controllers.grid.GridHandler.prototype.hasSameNumOfColumns=function(a,c){var d,e;d=this.getHtmlElement().find("th").length;e=a.first().find("td");e=c?e.attr("colspan"):e.length;return d==e};a.pkp.controllers.grid.GridHandler.prototype.replaceElementResponseHandler=function(a,c){var d;d=this.handleJson(c);if(!1!==d)if(d.elementNotFound){d=d.elementNotFound;d=this.getHtmlElement().find(".element"+d);if(0===
d.length)return!1;this.deleteElement(d)}else this.insertOrReplaceElement_(d.content),this.activateRowActions_()};a.pkp.controllers.grid.GridHandler.prototype.refreshGridWithFilterHandler_=function(b,c,d){a.post(this.fetchGridUrl_,d,this.callbackWrapper(this.replaceGridResponseHandler_),"json")};a.pkp.controllers.grid.GridHandler.prototype.addRowHandler_=function(b,c,d){a.get(this.fetchRowUrl,d,this.callbackWrapper(this.replaceElementResponseHandler),"json")};a.pkp.controllers.grid.GridHandler.prototype.replaceGridResponseHandler_=
function(a,c){var d,e;d=this.handleJson(c);!1!==d&&(e=this.getHtmlElement(),e.replaceWith(d.content),this.activateRowActions_())};a.pkp.controllers.grid.GridHandler.prototype.insertOrReplaceElement_=function(b){var c,d,b=a(b);c=b.attr("id");d=this.getHtmlElement();c=c?d.find("#"+c):null;if(null!==c&&1<c.length)throw Error("There were "+c.length+" rather than 0 or 1 elements to be replaced!");this.hasSameNumOfColumns(b)?null!==c&&1===c.length?this.replaceElement(c,b):this.appendElement(b):a.get(this.fetchGridUrl_,
null,this.callbackWrapper(this.replaceGridResponseHandler_),"json")};a.pkp.controllers.grid.GridHandler.prototype.deleteControlsRow_=function(b){b=a("#"+b.attr("id")+"-control-row",this.getHtmlElement());b.is("tr")&&b.hasClass("row_controls")&&b.remove()};a.pkp.controllers.grid.GridHandler.prototype.getControlRowByGridRow=function(b){b=b.attr("id")+"-control-row";return a("#"+b)};a.pkp.controllers.grid.GridHandler.prototype.activateRowActions_=function(){this.getHtmlElement().find("a.settings").unbind("click").bind("click",
this.callbackWrapper(this.toggleRowActions))};a.pkp.controllers.grid.GridHandler.prototype.applyToggleRowActionEffect_=function(a){var c;c=a.prev().find("td:not(.indent_row)");c=c.add(a.prev());a.is(":visible")?(setTimeout(function(){c.removeClass("no_border")},0),a.hide(0)):(c.addClass("no_border"),a.show(0))};a.pkp.controllers.grid.GridHandler.prototype.addFeature_=function(a,c){this.features_||(this.features_=[]);this.features_[a]=c};a.pkp.controllers.grid.GridHandler.prototype.initFeatures_=function(b){var c,
d;for(c in b)d=a.pkp.classes.Helper.objectFactory(b[c].JSClass,[this,b[c].options]),this.addFeature_(c,d),this.features_[c].init()}})(jQuery);(function(a){a.pkp.controllers.grid.CategoryGridHandler=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.controllers.grid.CategoryGridHandler,a.pkp.controllers.grid.GridHandler);a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryIdPrefix=function(){return this.getGridIdPrefix()+"-category-"};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategories=function(){return a(".category_grid_body:not(.empty)",this.getHtmlElement())};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryByDataId=
function(b){return a("#"+this.getCategoryIdPrefix()+b)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryRow=function(b){var c=this.getHtmlElement();void 0!==b&&(c=b);return a("tr.category",c)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getRowsInCategory=function(b){return a("tr.gridRow",b).not(".category")};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryEmptyPlaceholder=function(b){b="#"+b.attr("id")+"-emptyPlaceholder";return a(b,this.getHtmlElement())};
a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryDataId=function(a){var a=a.attr("id"),c=this.getCategoryIdPrefix().length;return a.slice(c)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getCategoryDataIdByRowId=function(b){b=b.replace(this.getCategoryIdPrefix()," ");b=b.match("(.*)-row");return a.trim(b[1])};a.pkp.controllers.grid.CategoryGridHandler.prototype.appendCategory=function(a){this.getHtmlElement().find(this.bodySelector).append(a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.resequenceCategories=
function(b){var c,d;for(d in b)c=b[d],c=a("#"+c),this.appendCategory(c);this.updateEmptyPlaceholderPosition()};a.pkp.controllers.grid.CategoryGridHandler.prototype.updateEmptyPlaceholderPosition=function(){var b=this.getCategories(),c,d,e,f;c=0;for(d=b.length;c<d;c++)e=a(b[c]),f=this.getCategoryEmptyPlaceholder(e),0<f.length&&f.insertAfter(e)};a.pkp.controllers.grid.CategoryGridHandler.prototype.initialize=function(a){this.fetchCategoryUrl_=a.fetchCategoryUrl;this.parent("initialize",a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getElementsByType=
function(a){return a.hasClass("category_grid_body")?this.getCategories():this.parent("getElementsByType",a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.getEmptyElement=function(a){return a.hasClass("category_grid_body")?this.getHtmlElement().find(".empty").not(".category_placeholder"):this.parent("getEmptyElement",a)};a.pkp.controllers.grid.CategoryGridHandler.prototype.refreshGridHandler=function(b,c,d){var e=!1;void 0!==d&&(void 0!==d.parentElementId?(e={rowId:d[0],rowCategoryId:d.parentElementId},
this.currentCategoryId_=d.parentElementId,a.get(this.fetchRowUrl,e,this.callbackWrapper(this.replaceElementResponseHandler),"json")):a.get(this.fetchCategoryUrl_,{rowId:d},this.callbackWrapper(this.replaceElementResponseHandler),"json"),e=!0);this.parent("refreshGridHandler",b,c,d,e)};a.pkp.controllers.grid.CategoryGridHandler.prototype.deleteElement=function(b){var c,d,e,f;if(1<b.length&&(2==b.length&&(b.hasClass("category_grid_body")&&b.hasClass("category"))&&(b=b.filter(".category_grid_body")),
this.currentCategoryId_)){c=this.getCategoryByDataId(this.currentCategoryId_);d=0;for(e=b.length;d<e;d++)if(f=a(b[d]).parents("#"+c.attr("id")),1===f.length){b=a(b[d]);break}}b.hasClass("category_grid_body")&&(c=this.getCategoryEmptyPlaceholder(b),c.remove());this.parent("deleteElement",b)};a.pkp.controllers.grid.CategoryGridHandler.prototype.appendElement=function(a){var c=null;a.hasClass("gridRow")&&(c=this.getCategoryDataIdByRowId(a.attr("id")),c=this.getCategoryByDataId(c));this.parent("appendElement",
a,c);a.hasClass("category_grid_body")&&(a=this.getEmptyElement(a),this.getHtmlElement().find(this.bodySelector).append(a))};a.pkp.controllers.grid.CategoryGridHandler.prototype.replaceElement=function(a,c){c.hasClass("category_grid_body")&&this.getCategoryEmptyPlaceholder(a).remove();this.parent("replaceElement",a,c)};a.pkp.controllers.grid.CategoryGridHandler.prototype.hasSameNumOfColumns=function(a){var c=a,d=!1;a.hasClass("category_grid_body")&&(c=a.find("tr"),d=!0);return this.parent("hasSameNumOfColumns",
c,d)}})(jQuery);(function(a){jQuery.pkp.controllers.linkAction=jQuery.pkp.controllers.linkAction||{};a.pkp.controllers.linkAction.LinkActionHandler=function(b,c){this.parent(b,c);this.staticId_=c.staticId?c.staticId:b.attr("id");if(!c.actionRequest||!c.actionRequestOptions)throw Error('The "actionRequest" and "actionRequestOptions"settings are required in a LinkActionHandler');b.hasClass("image")&&this.bind("mouseover",this.imagePreviewHandler_);c.actionRequestOptions.finishCallback=this.callbackWrapper(this.enableLink);
this.linkActionRequest_=a.pkp.classes.Helper.objectFactory(c.actionRequest,[b,c.actionRequestOptions]);this.bindActionRequest();this.publishEvent("dataChanged");this.bind("dataChanged",this.dataChangedHandler_);this.bind("modalCanceled",this.removeDisabledCssClass_);c.selfActivate&&this.trigger("click")};a.pkp.classes.Helper.inherits(a.pkp.controllers.linkAction.LinkActionHandler,a.pkp.classes.Handler);a.pkp.controllers.linkAction.LinkActionHandler.prototype.linkActionRequest_=null;a.pkp.controllers.linkAction.LinkActionHandler.prototype.staticId_=
null;a.pkp.controllers.linkAction.LinkActionHandler.prototype.getStaticId=function(){return this.staticId_};a.pkp.controllers.linkAction.LinkActionHandler.prototype.getUrl=function(){return this.linkActionRequest_.getUrl()};a.pkp.controllers.linkAction.LinkActionHandler.prototype.imagePreviewHandler_=function(b){a(b).imgPreview({preloadImages:!1,imgCSS:{width:"300px"}})};a.pkp.controllers.linkAction.LinkActionHandler.prototype.activateAction=function(a,c){"$.pkp.classes.linkAction.NullAction"!=this.linkActionRequest_.getObjectName()&&
this.disableLink();return this.linkActionRequest_.activate.call(this.linkActionRequest_,a,c)};a.pkp.controllers.linkAction.LinkActionHandler.prototype.bindActionRequest=function(){this.bind("click",this.activateAction)};a.pkp.controllers.linkAction.LinkActionHandler.prototype.enableLink=function(){var b,c;b=a(this.getHtmlElement());this.getHtmlElement().is(":submit")||this.removeDisabledCssClass_();c=this.getUrl();this.getHtmlElement().is("a")&&c&&b.attr("href",c);this.unbind("click",this.noAction_);
this.bindActionRequest()};a.pkp.controllers.linkAction.LinkActionHandler.prototype.disableLink=function(){var b=a(this.getHtmlElement());b.addClass("ui-state-disabled");this.getHtmlElement().is("a")&&b.attr("href","#");this.unbind("click",this.activateAction);this.bind("click",this.noAction_)};a.pkp.controllers.linkAction.LinkActionHandler.prototype.removeDisabledCssClass_=function(){a(this.getHtmlElement()).removeClass("ui-state-disabled")};a.pkp.controllers.linkAction.LinkActionHandler.prototype.dataChangedHandler_=
function(a,c,d){0===this.getHtmlElement().parents(".pkp_controllers_grid").length&&this.trigger("redirectDataChangedToGrid",[d]);this.trigger("notifyUser",[this.getHtmlElement()])};a.pkp.controllers.linkAction.LinkActionHandler.prototype.noAction_=function(){return!1}})(jQuery);(function(a){a.pkp.controllers.modal=a.pkp.controllers.modal||{};a.pkp.controllers.modal.ModalHandler=function(b,c){this.parent(b,c);if(!this.checkOptions(c))throw Error("Missing or invalid modal options!");var d=a.extend(!0,{},c),d=this.mergeOptions(d);b.dialog(d);this.fixTitleBar_(b,d);this.fixCloseButton_(b,d);400>b.width()&&b.dialog("option","width","400");710<b.width()&&b.dialog("option","width","710");b.dialog("option","position",["center",100]);this.bind("dialogclose",this.dialogClose);this.publishEvent("redirectRequested");
this.publishEvent("dataChanged");this.publishEvent("containerReloadRequested");this.publishEvent("modalCanceled");this.publishEvent("updateHeader");this.publishEvent("updateSidebar");this.bind("notifyUser",this.redirectNotifyUserEventHandler_);b.parent().next(".ui-widget-overlay").click(this.callbackWrapper(this.outsideClick))};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.ModalHandler,a.pkp.classes.Handler);a.pkp.controllers.modal.ModalHandler.DEFAULT_OPTIONS_={autoOpen:!0,width:710,modal:!0,
draggable:!1,resizable:!1,position:["center",100]};a.pkp.controllers.modal.ModalHandler.prototype.checkOptions=function(a){return"object"===typeof a&&void 0===a.buttons};a.pkp.controllers.modal.ModalHandler.prototype.mergeOptions=function(b){return a.extend(!0,{},this.self("DEFAULT_OPTIONS_"),b)};a.pkp.controllers.modal.ModalHandler.prototype.modalClose=function(b,c){c&&"cancelFormButton"==c.currentTarget.id&&this.trigger("modalCanceled");var d=this.getHtmlElement(),e=d.find("form").first();if(1==
e.length&&(e=a.pkp.classes.Handler.getHandler(a("#"+e.attr("id"))),e.formChangesTracked))if(confirm(a.pkp.locale.form_dataHasChanged))this.trigger("unregisterAllForms");else return!1;d.dialog("close");return!1};a.pkp.controllers.modal.ModalHandler.prototype.dialogClose=function(b){a(b).dialog("destroy");this.getHtmlElement().empty();this.remove()};a.pkp.controllers.modal.ModalHandler.prototype.outsideClick=function(a,c){this.modalClose(a,c)};a.pkp.controllers.modal.ModalHandler.prototype.fixTitleBar_=
function(b,c){var d=a('<div class="pkp_controllers_modal_titleBar"></div>'),e,f=c.title||null,g=c.titleIcon||"";e=a('<a class="close ui-corner-all" href="#"><span class="xIcon">close</span></a>"');e.click(this.callbackWrapper(this.modalClose));d.append(e);f&&d.append(['<div class="large_sprite modal_title '+g+'"></div><h2>',f,"</h2>"].join(""));d.append(a('<span style="clear:both" />'));b.parent().find(".ui-dialog-titlebar").replaceWith(d)};a.pkp.controllers.modal.ModalHandler.prototype.fixCloseButton_=
function(b){var c=a('<a id="cancelFormButton" class="cancelFormButton" href="#">Cancel</a>'),b=b.parent();b.find(".ui-dialog-buttonset").css({width:"90%",padding:"10px 20px"});b.find(".ui-dialog-buttonset button:first").css({"float":"right",margin:"0px"});b.find(".ui-dialog-buttonset button:last").replaceWith(c);b.find(".cancelFormButton").bind("click",this.callbackWrapper(this.modalClose))};a.pkp.controllers.modal.ModalHandler.prototype.redirectNotifyUserEventHandler_=function(b,c,d){a.pkp.classes.notification.NotificationHelper.redirectNotifyUserEvent(this,
d)}})(jQuery);(function(a){a.pkp.controllers.modal.ConfirmationModalHandler=function(a,c){this.parent(a,c)};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.ConfirmationModalHandler,a.pkp.controllers.modal.ModalHandler);a.pkp.controllers.modal.ConfirmationModalHandler.prototype.checkOptions=function(a){return!this.parent("checkOptions",a)?!1:"string"===typeof a.okButton&&(!1===a.cancelButton||"string"===typeof a.cancelButton)&&"string"===typeof a.dialogText};a.pkp.controllers.modal.ConfirmationModalHandler.prototype.mergeOptions=
function(a){var c=this.parent("mergeOptions",a);c.buttons={};c.buttons[a.okButton]=this.callbackWrapper(this.modalConfirm);delete a.okButton;a.cancelButton&&(c.buttons[a.cancelButton]=this.callbackWrapper(this.modalClose),delete a.cancelButton);this.getHtmlElement().html(c.dialogText);delete c.dialogText;return c};a.pkp.controllers.modal.ConfirmationModalHandler.prototype.modalConfirm=function(a){this.modalClose(a)}})(jQuery);(function(a){a.pkp.controllers.modal.RemoteActionConfirmationModalHandler=function(a,c){this.parent(a,c);this.remoteAction_=c.remoteAction};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.RemoteActionConfirmationModalHandler,a.pkp.controllers.modal.ConfirmationModalHandler);a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.remoteAction_=null;a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.checkOptions=function(a){return!this.parent("checkOptions",
a)?!1:"string"===typeof a.cancelButton&&"string"===typeof a.remoteAction};a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.modalConfirm=function(){a.post(this.remoteAction_,this.callbackWrapper(this.remoteResponse),"json")};a.pkp.controllers.modal.RemoteActionConfirmationModalHandler.prototype.remoteResponse=function(a,c){!1!==this.parent("remoteResponse",a,c)&&this.modalClose(a);return!1}})(jQuery);(function(a){a.pkp.controllers.modal.AjaxModalHandler=function(a,c){this.parent(a,c);this.bind("formSubmitted",this.modalClose);this.bind("formCanceled",this.modalClose);this.bind("ajaxHtmlError",this.modalClose)};a.pkp.classes.Helper.inherits(a.pkp.controllers.modal.AjaxModalHandler,a.pkp.controllers.modal.ModalHandler);a.pkp.controllers.modal.AjaxModalHandler.prototype.checkOptions=function(a){return!this.parent("checkOptions",a)?!1:"string"===typeof a.url};a.pkp.controllers.modal.AjaxModalHandler.prototype.mergeOptions=
function(a){this.bind("dialogopen",this.dialogOpen);return this.parent("mergeOptions",a)};a.pkp.controllers.modal.AjaxModalHandler.prototype.modalClose=function(a,c){"formSubmitted"==c.type&&this.getHtmlElement().parent().trigger("notifyUser");return this.parent("modalClose")};a.pkp.controllers.modal.AjaxModalHandler.prototype.dialogOpen=function(b){var b=a(b),c;b.css({"max-height":600,"overflow-y":"auto","z-index":"10000"});c=b.dialog("option","url");b.pkpAjaxHtml(c)}})(jQuery);(function(a){a.pkp.controllers.AutocompleteHandler=function(b,c){var d;this.parent(b,c);this.sourceUrl_=c.sourceUrl;c.sourceUrl=void 0;this.jLabelText_=c.jLabelText;d={};d.source=this.callbackWrapper(this.fetchAutocomplete);d=a.extend({},this.self("DEFAULT_PROPERTIES_"),d,c);this.textInput=b.find(":text");this.textInput.keyup(this.callbackWrapper(this.synchronizeFields_));this.textInput.autocomplete(d);this.textInput.attr("title",this.jLabelText_);a("#"+this.textInput.attr("id")).jLabel();this.textInput.attr("title",
"");this.textLabel_=b.find("label");this.hiddenInput_=b.find("input:hidden");this.bind("autocompleteselect",this.itemSelected);this.bind("autocompletefocus",this.itemFocused);this.textInput.blur(this.callbackWrapper(this.textInputBlurHandler_))};a.pkp.classes.Helper.inherits(a.pkp.controllers.AutocompleteHandler,a.pkp.classes.Handler);a.pkp.controllers.AutocompleteHandler.textLabel_=null;a.pkp.controllers.AutocompleteHandler.jLabelText_=null;a.pkp.controllers.AutocompleteHandler.DEFAULT_PROPERTIES_=
{minLength:2};a.pkp.controllers.AutocompleteHandler.prototype.hiddenInput_=null;a.pkp.controllers.AutocompleteHandler.prototype.sourceUrl_=null;a.pkp.controllers.AutocompleteHandler.prototype.textInput=null;a.pkp.controllers.AutocompleteHandler.prototype.itemSelected=function(a,c,d){a=this.hiddenInput_;c=this.textInput;""!==d.item.value&&(a.val(d.item.value),c.val(d.item.label),c.trigger("keyup"));return!1};a.pkp.controllers.AutocompleteHandler.prototype.itemFocused=function(a,c,d){a=this.textInput;
""!==d.item.value&&a.val(d.item.label);return!1};a.pkp.controllers.AutocompleteHandler.prototype.fetchAutocomplete=function(b,c,d){var e;e=this.textInput;e.addClass("spinner");a.post(this.getAutocompleteUrl(),{term:c.term},function(a){e.removeClass("spinner");d(a.content)},"json")};a.pkp.controllers.AutocompleteHandler.prototype.getAutocompleteUrl=function(){return this.sourceUrl_};a.pkp.controllers.AutocompleteHandler.prototype.setAutocompleteUrl=function(a){this.sourceUrl_=a};a.pkp.controllers.AutocompleteHandler.prototype.textInputBlurHandler_=
function(){""===this.hiddenInput_.val()&&this.textInput.val("")};a.pkp.controllers.AutocompleteHandler.prototype.synchronizeFields_=function(){this.hiddenInput_.val(String(this.textInput.val()))}})(jQuery);(function(a){a.fn.pkpHandler=function(b,c){this.each(function(){var d=a(this);c=c||{};a.pkp.classes.Helper.objectFactory(b,[d,c])});return this};a.fn.pkpAjaxHtml=function(b,c){var d=this.first();a.ajax({url:b,dataType:"json",success:function(a){d.find("#loading").hide();!0===a.status?(a.content&&d.html(a.content),c&&c()):(d.trigger("ajaxHtmlError",a.content),alert(a.content))},error:function(){alert("Failed Ajax request or invalid JSON returned.")}});d.html("<div id='loading' class='throbber'></div>");
return this}})(jQuery);
